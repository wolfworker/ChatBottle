@{
    ViewBag.Title = "流浪瓶";
}

<style>
    .userimg {
        height: 50px;
        width: 50px;
    }

    .openBottle {
        float: left;
        padding-left: 5px;
        width: 70%;
        text-align: left;
    }

    .textdesc {
        padding-top: 15px;
        display: block;
    }

    .detailright {
        float: right;
        padding-right: 5px;
        width: 15%;
        text-align: right;
    }

    .bottleline {
        border-bottom: 1px solid #ccc;
        padding-top: 5px;
        margin-bottom: 5px;
    }
</style>
<div id="noBottle" style="display:none">暂时还没有瓶子哦，去<a id="pickBottle">捡一个</a>试试？</div>
<div id="bottleList" style="display:none;font-size:13px"></div>

<script type="text/javascript">

    $("#pickBottle").click(function () {
        loadPage(pageName.PickBottle);
    });

    var bindClick = function () {
        $(".openBottle").click(function () {
            var param = "?bottleId=" + this.dataset.bottleid;
            loadPage(pageName.BottleDetail, param);
        });
    }

    var myBottleInit = function () {
        $("#bottleList").hide();
        $("#noBottle").hide();
        $.ajax({
            url: serviceurl + "/api/Bottle/QueryByUserId",
            type: "get",
            data: { userId: userid },
            success: function (result) {
                if (result.Result != undefined && result.Result.length > 0) {
                    var html = "";
                    var bottleData = result.Result;
                    $.each(bottleData, function (i, item) {
                        html += '<div style="height: 50px;">';
                        html += '<div style="float: left;"><img src="../Content/img/background.jpg" class="userimg"></div>';
                        html += '<div class="openBottle" data-bottleid="' + item.ID + '" ><span >' + item.ThrowUserName + "(" + item.AreaName + ')</span><span class="textdesc" >' + item.BottleDesc + '</span></div>';

                        html += '<div class="detailright" ><span>' + item.UpdateTime.FormatToDate("hh:mm") + '</span></div>';
                        html += '</div>';
                        html += '<div class="bottleline"></div>';
                    });
                    $("#bottleList").append(html);
                    $("#bottleList").show();
                    bindClick();
                } else {
                    $("#noBottle").show();
                }
            },
            error: function (result) {
                $("#noBottle").show();
            }
        });
    }

    myBottleInit();

</script>